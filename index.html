<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>云端资源极速搜</title>
    <script src="https://cdn.staticfile.org/tailwindcss/3.3.3/tailwind.min.js"></script>
    <script crossorigin src="https://cdn.staticfile.org/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.staticfile.org/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://cdn.staticfile.org/babel-standalone/7.22.17/babel.min.js"></script>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/lucide-react@0.263.1/dist/umd/lucide-react.min.js"></script>
    <style>
        @keyframes text-shimmer { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
        .animate-text-shimmer { animation: text-shimmer 3s ease-in-out infinite alternate; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        * { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-[#050301] text-slate-200 font-sans selection:bg-orange-500/30 overflow-x-hidden">
    <div id="root"><div style="color:#666;text-align:center;margin-top:40vh;font-size:14px;">资源引擎加载中...</div></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const Icons = window.lucideReact;
        const { Search, X, Cloud, Disc, HardDrive, Zap, Database, Loader2, Flame, Gift, Play, Archive } = Icons || {};
        const DEFAULT_API = "sodx.zeabur.app";
        const COMMISSION_LINK = "https://pages.aliyundrive.com/mobile-page/web/commission.html?disableNav=YES";
        const BLOCK_LIST = ["色情", "av", "AV", "色诱", "淫", "荡", "乱伦", "偷拍", "露点", "强奸", "裸聊", "毒品", "赌博", "萝莉", "幼女", "嫩模", "三级", "禁片", "枪支", "迷药", "h漫", "本子", "福利姬"];

        const checkSafety = (text) => {
            if(!text) return null;
            return BLOCK_LIST.find(word => text.toLowerCase().includes(word.toLowerCase()));
        };

        const PROVIDERS = {
            aliyun: { id: 'aliyun', name: '阿里云盘', icon: Icons ? <Cloud size={14} /> : null, style: 'bg-gradient-to-br from-orange-500/10 to-amber-500/5 text-orange-400 border-orange-500/30 hover:border-orange-400 hover:shadow-[0_0_20px_rgba(249,115,22,0.2)]', activeStyle: 'bg-gradient-to-r from-orange-600 to-amber-600 text-white shadow-lg shadow-orange-500/40 border-transparent', match: (url) => url.includes('alipan.com') || url.includes('aliyundrive.com') },
            quark: { id: 'quark', name: '夸克', icon: Icons ? <Disc size={14} /> : null, style: 'bg-white/5 text-slate-400 border-white/10 hover:border-white/20', activeStyle: 'bg-blue-600 text-white border-transparent', match: (url) => url.includes('pan.quark.cn') },
            baidu: { id: 'baidu', name: '百度', icon: Icons ? <HardDrive size={14} /> : null, style: 'bg-white/5 text-slate-400 border-white/10 hover:border-white/20', activeStyle: 'bg-red-600 text-white border-transparent', match: (url) => url.includes('pan.baidu.com') },
            xunlei: { id: 'xunlei', name: '迅雷', icon: Icons ? <Zap size={14} /> : null, style: 'bg-white/5 text-slate-400 border-white/10 hover:border-white/20', activeStyle: 'bg-sky-500 text-white border-transparent', match: (url) => url.includes('pan.xunlei.com') },
            '115': { id: '115', name: '115', icon: Icons ? <Archive size={14} /> : null, style: 'bg-white/5 text-slate-400 border-white/10 hover:border-white/20', activeStyle: 'bg-indigo-500 text-white border-transparent', match: (url) => url.includes('115.com') },
            other: { id: 'other', name: '其他', icon: Icons ? <Database size={14} /> : null, style: 'bg-white/5 text-slate-400 border-white/10 hover:border-white/20', activeStyle: 'bg-slate-600 text-white border-transparent', match: () => true }
        };

        const App = () => {
            const [keyword, setKeyword] = useState('');
            const [allItems, setAllItems] = useState([]);
            const [filteredItems, setFilteredItems] = useState([]);
            const [activeTab, setActiveTab] = useState('all');
            const [counts, setCounts] = useState({});
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [apiUrl, setApiUrl] = useState(DEFAULT_API);
            const [showSettings, setShowSettings] = useState(false);
            const [secretCount, setSecretCount] = useState(0);
            const [downloadModal, setDownloadModal] = useState({ show: false, url: '' });

            useEffect(() => { const savedUrl = localStorage.getItem('pansou_custom_api'); if (savedUrl) setApiUrl(savedUrl); }, []);
            const handleSecret = () => { setSecretCount(p => p + 1); if (secretCount + 1 >= 5) { setShowSettings(true); setSecretCount(0); } setTimeout(() => setSecretCount(0), 3000); };
            const getSafeUrl = () => { let url = apiUrl.trim(); if (!url.startsWith('http')) url = `https://${url}`; if (url.endsWith('/')) url = url.slice(0, -1); return url; };
            const handleSearch = async (e) => {
                if (e) e.preventDefault(); if (!keyword.trim()) return;
                if (checkSafety(keyword)) { setError(`关键词包含违规内容，系统已自动拦截。`); setAllItems([]); return; }
                setLoading(true); setError(null); setAllItems([]); setFilteredItems([]); setCounts({});
                try {
                    const response = await fetch(`${getSafeUrl()}/api/search?kw=${encodeURIComponent(keyword)}&res=merge`);
                    const rawText = await response.text();
                    let data; try { data = JSON.parse(rawText); } catch (e) { throw new Error("API Error"); }
                    let rawList = [];
                    if (data?.data?.merged_by_type) Object.values(data.data.merged_by_type).forEach(arr => { if (Array.isArray(arr)) rawList = [...rawList, ...arr]; });
                    else if (data?.data && Array.isArray(data.data)) rawList = data.data;
                    else if (data?.list && Array.isArray(data.list)) rawList = data.list;
                    else if (Array.isArray(data)) rawList = data;
                    const processedList = rawList.map(item => {
                        const url = item.url || "";
                        let provider = 'other';
                        for (const key in PROVIDERS) { if (key !== 'other' && PROVIDERS[key].match(url)) { provider = key; break; } }
                        return { name: item.note || item.name || "未知资源", url, provider, time: item.datetime || item.time || "" };
                    }).filter(item => item.url && item.url.startsWith('http'));
                    if (processedList.length === 0) setError("未找到资源");
                    setAllItems(processedList);
                    const newCounts = { all: processedList.length };
                    processedList.forEach(item => { newCounts[item.provider] = (newCounts[item.provider] || 0) + 1; });
                    setCounts(newCounts);
                    if (newCounts['aliyun'] > 0) { setActiveTab('aliyun'); setFilteredItems(processedList.filter(i => i.provider === 'aliyun')); } 
                    else { setActiveTab('all'); setFilteredItems(processedList); }
                } catch (err) { setError("网络请求失败"); } finally { setLoading(false); }
            };
            const switchTab = (tabId) => { setActiveTab(tabId); setFilteredItems(tabId === 'all' ? allItems : allItems.filter(i => i.provider === tabId)); };
            const handleItemClick = (item) => { if (item.provider === 'aliyun') { setDownloadModal({ show: true, url: item.url }); } else { window.open(item.url, '_blank'); } };
            
            if (!Icons) return null;
            return (
                <div className="min-h-screen relative">
                    <div className="fixed inset-0 pointer-events-none"><div className="absolute top-[-20%] left-0 w-full h-[600px] bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-orange-800/20 via-[#0a0500] to-[#050301]"></div></div>
                    <nav className="fixed top-0 w-full z-50 px-6 py-6 pointer-events-none"><button onClick={handleSecret} className="pointer-events-auto p-4 opacity-0 hover:opacity-100 transition-opacity"><Cloud size={24} className="text-white/10" /></button></nav>
                    <main className="relative z-10 pt-32 pb-20 px-4 md:px-0">
                        <div className="max-w-xl mx-auto text-center mb-10">
                            <div className="relative group max-w-lg mx-auto mb-16">
                                <div className="absolute -inset-1 bg-gradient-to-r from-orange-600 via-red-500 to-amber-500 rounded-[2rem] blur-xl opacity-30 group-focus-within:opacity-60 animate-pulse transition duration-1000"></div>
                                <form onSubmit={handleSearch} className="relative flex items-center bg-[#120a05]/90 backdrop-blur-xl border border-orange-500/20 rounded-[1.5rem] p-1.5 shadow-2xl transition-all focus-within:border-orange-500/50">
                                    <div className="pl-5 text-orange-500/60 group-focus-within:text-orange-400 transition-colors"><Search size={22} /></div>
                                    <input type="text" value={keyword} onChange={(e) => setKeyword(e.target.value)} placeholder="搜你所想..." className="w-full h-12 px-4 bg-transparent outline-none text-white text-lg placeholder:text-white/10 font-bold text-center tracking-wide"/>
                                    <button type="submit" disabled={loading} className="h-12 px-6 bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-500 hover:to-amber-500 text-white rounded-2xl font-black transition-all shadow-lg shadow-orange-900/40 active:scale-95 disabled:opacity-50">{loading ? <Loader2 className="animate-spin" size={20} /> : "GO"}</button>
                                </form>
                            </div>
                            {!loading && allItems.length === 0 && !error && (
                                <div className="animate-in fade-in zoom-in duration-1000 select-none cursor-default">
                                    <h1 className="text-5xl md:text-6xl font-black italic tracking-tighter mb-4"><span className="text-transparent bg-clip-text bg-gradient-to-br from-orange-400 via-amber-200 to-orange-500 drop-shadow-[0_0_15px_rgba(245,158,11,0.5)]">阿里云盘</span></h1>
                                    <h2 className="text-2xl md:text-3xl font-black text-white/90 tracking-widest drop-shadow-[0_0_10px_rgba(255,255,255,0.3)]">不用会员也能看</h2>
                                    <div className="mt-12 flex justify-center opacity-40"><div className="w-20 h-1 bg-gradient-to-r from-transparent via-orange-500 to-transparent rounded-full"></div></div>
                                </div>
                            )}
                        </div>
                        {error && <div className="max-w-md mx-auto mb-8 p-3 bg-red-900/20 border border-red-500/20 rounded-lg text-center text-red-400 text-sm animate-in fade-in">{error}</div>}
                        {!loading && allItems.length > 0 && (
                            <div className="max-w-5xl mx-auto mb-6 flex justify-center flex-wrap gap-2 animate-in slide-in-from-bottom-2">
                                {Object.keys(PROVIDERS).map(key => {
                                    const count = counts[key] || 0; if (count === 0 && key !== 'other') return null; const p = PROVIDERS[key]; const isActive = activeTab === key;
                                    return <button key={key} onClick={() => switchTab(key)} className={`px-4 py-2 rounded-xl text-xs font-bold border transition-all flex items-center gap-1.5 ${isActive ? p.activeStyle : p.style + ' bg-white/5'}`}>{p.icon} {p.name} <span className="opacity-60 text-[10px]">{count}</span></button>
                                })}
                                <button onClick={() => switchTab('all')} className={`px-4 py-2 rounded-xl text-xs font-bold border transition-all ${activeTab === 'all' ? 'bg-slate-700 text-white border-transparent' : 'bg-white/5 text-slate-500 border-white/5 hover:bg-white/10'}`}>全部</button>
                            </div>
                        )}
                        <div className="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-3">
                            {filteredItems.map((item, idx) => {
                                const p = PROVIDERS[item.provider]; const isAliyun = item.provider === 'aliyun';
                                return (
                                    <div key={idx} className={`group relative backdrop-blur-md border rounded-2xl p-4 transition-all duration-300 active:scale-[0.99] ${isAliyun ? 'bg-[#120804]/90 border-orange-500/30 shadow-[0_4px_20px_-5px_rgba(249,115,22,0.15)]' : 'bg-[#18181b]/60 border-white/5'}`}>
                                        {isAliyun && <div className="absolute -top-px -right-px px-2 py-0.5 bg-orange-600/20 rounded-bl-lg border-b border-l border-orange-500/20"><span className="text-[9px] font-bold text-orange-400 flex items-center gap-1"><Flame size={8} fill="currentColor" />极速</span></div>}
                                        <div className="flex gap-3 items-center">
                                            <div className={`p-2.5 rounded-xl shrink-0 ${isAliyun ? 'bg-orange-500/10 text-orange-500' : 'bg-white/5 text-slate-500'}`}>{p.icon}</div>
                                            <div className="flex-1 min-w-0"><h3 className={`font-bold text-sm truncate pr-4 mb-1 ${isAliyun ? 'text-orange-50' : 'text-slate-300'}`}>{item.name}</h3>
                                            <div className="flex items-center gap-2"><span className={`text-[9px] px-1.5 py-0.5 rounded border ${isAliyun ? 'bg-orange-500/10 border-orange-500/20 text-orange-400' : 'bg-white/5 border-white/5 text-slate-500'}`}>{p.name}</span>{item.time && <span className="text-[9px] text-slate-500 font-mono">{item.time.replace('T', ' ').substring(0, 10)}</span>}</div></div>
                                        </div>
                                        <div className="mt-4 flex gap-2 opacity-80"><button onClick={() => navigator.clipboard.writeText(item.url).then(()=>alert("已复制"))} className="flex-1 py-2 bg-white/5 rounded-lg text-[10px] font-bold text-slate-400">复制</button><button onClick={() => handleItemClick(item)} className={`flex-1 py-2 rounded-lg text-[10px] font-bold text-white shadow-lg ${isAliyun ? 'bg-gradient-to-r from-orange-600 to-amber-600' : 'bg-slate-700'}`}>打开</button></div>
                                    </div>
                                )
                            })}
                        </div>
                    </main>
                    {downloadModal.show && (
                        <div className="fixed inset-0 z-[200] flex items-center justify-center bg-black/90 backdrop-blur-sm p-8 animate-in fade-in">
                            <div className="bg-[#120a05] w-full max-w-sm rounded-3xl border border-orange-500/40 p-8 relative shadow-[0_0_60px_rgba(234,88,12,0.4)] animate-in zoom-in-95">
                                <button onClick={() => setDownloadModal({show:false, url:''})} className="absolute top-4 right-4 text-slate-600 hover:text-white"><X size={20}/></button>
                                <div className="text-center"><div className="inline-block p-4 rounded-full bg-orange-500/10 text-orange-500 mb-6 animate-bounce"><Gift size={32} fill="currentColor" /></div>
                                    <h3 className="text-xl font-black text-white mb-6">不用会员也能看，不限速！</h3>
                                    <div className="space-y-3">
                                        <a href={COMMISSION_LINK} target="_blank" rel="noopener noreferrer" onClick={() => setDownloadModal({show:false, url:''})} className="flex items-center justify-center gap-2 w-full py-4 bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-500 hover:to-amber-500 text-white font-black rounded-xl shadow-lg shadow-orange-900/40 active:scale-95 transition-all text-sm"><Play size={16} fill="currentColor" /> 前往观看</a>
                                        <a href={downloadModal.url} target="_blank" rel="noopener noreferrer" onClick={() => setDownloadModal({show:false, url:''})} className="block w-full py-2 text-[10px] font-bold text-slate-600 hover:text-white transition-colors">已安装，直接前往 &gt;</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    {showSettings && (<div className="fixed inset-0 z-[300] flex items-center justify-center bg-black/90 p-8"><div className="bg-[#111] p-6 rounded-2xl w-full max-w-sm border border-white/10"><h3 className="font-bold text-white mb-4">API Config</h3><input value={apiUrl} onChange={e => {setApiUrl(e.target.value); localStorage.setItem('pansou_custom_api', e.target.value)}} className="w-full bg-black border border-white/20 p-3 text-white rounded-lg text-xs font-mono outline-none focus:border-orange-500"/><button onClick={() => setShowSettings(false)} className="mt-4 w-full py-3 bg-white text-black font-bold rounded-lg text-xs">保存</button></div></div>)}
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root')); root.render(<App />);
    </script>
</body>
</html>