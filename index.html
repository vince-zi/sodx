<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>阿里云盘搜索 - 极速版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* 针对移动端的额外优化 */
        body { -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-[#050301]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 1. 图标库 (为了单文件运行，手动封装图标) ---
        const Icons = {
            Search: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            Cloud: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.5 19c0-1.7-1.3-3-3-3h-1.1c-.1-2.9-2.5-5.3-5.4-5.3-2.6 0-4.8 1.9-5.3 4.4C1.2 16.2 2.1 19 5 19h12.5c1.4 0 2.5-1.1 2.5-2.5v-.5"/></svg>,
            Disc: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>,
            HardDrive: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" x2="2" y1="12" y2="12"/><path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/><line x1="6" x2="6.01" y1="16" y2="16"/><line x1="10" x2="10.01" y1="16" y2="16"/></svg>,
            Zap: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Archive: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="5" x="2" y="3" rx="1"/><path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8"/><path d="M10 12h4"/></svg>,
            Database: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
            Loader2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
            Flame: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3.3.3-1.2 1-2.4 1.5-3.2.5 1.5 1.5 3 2.5 4.5z"/></svg>,
            Gift: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/></svg>,
            Play: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            X: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        };

        // --- 2. 核心逻辑配置 ---
        const DEFAULT_API = "sodx.zeabur.app";
        const COMMISSION_LINK = "https://pages.aliyundrive.com/mobile-page/web/commission.html?disableNav=YES";

        const BLOCK_LIST = [
            "色情", "av", "AV", "色诱", "淫", "荡", "乱伦", "偷拍", "露点", 
            "强奸", "裸聊", "毒品", "赌博", "萝莉", "幼女", "嫩模", 
            "三级", "禁片", "枪支", "迷药", "h漫", "本子", "福利姬"
        ];

        const checkSafety = (text) => {
            return BLOCK_LIST.find(word => text.toLowerCase().includes(word.toLowerCase()));
        };

        const PROVIDERS = {
            aliyun: {
                id: 'aliyun',
                name: '阿里云盘',
                icon: <Icons.Cloud size={14} />,
                style: 'bg-gradient-to-br from-orange-500/10 to-amber-500/5 text-orange-400 border-orange-500/30 hover:border-orange-400 hover:shadow-[0_0_20px_rgba(249,115,22,0.2)]',
                activeStyle: 'bg-gradient-to-r from-orange-600 to-amber-600 text-white shadow-lg shadow-orange-500/40 border-transparent',
                match: (url) => url.includes('alipan.com') || url.includes('aliyundrive.com')
            },
            quark: {
                id: 'quark',
                name: '夸克',
                icon: <Icons.Disc size={14} />,
                style: 'bg-white/5 text-slate-400 border-white/10 hover:border-white/20',
                activeStyle: 'bg-blue-600 text-white border-transparent',
                match: (url) => url.includes('pan.quark.cn')
            },
            baidu: {
                id: 'baidu',
                name: '百度',
                icon: <Icons.HardDrive size={14} />,
                style: 'bg-white/5 text-slate-400 border-white/10 hover:border-white/20',
                activeStyle: 'bg-red-600 text-white border-transparent',
                match: (url) => url.includes('pan.baidu.com')
            },
            xunlei: {
                id: 'xunlei',
                name: '迅雷',
                icon: <Icons.Zap size={14} />,
                style: 'bg-white/5 text-slate-400 border-white/10 hover:border-white/20',
                activeStyle: 'bg-sky-500 text-white border-transparent',
                match: (url) => url.includes('pan.xunlei.com')
            },
            '115': {
                id: '115',
                name: '115',
                icon: <Icons.Archive size={14} />,
                style: 'bg-white/5 text-slate-400 border-white/10 hover:border-white/20',
                activeStyle: 'bg-indigo-500 text-white border-transparent',
                match: (url) => url.includes('115.com')
            },
            other: {
                id: 'other',
                name: '其他',
                icon: <Icons.Database size={14} />,
                style: 'bg-white/5 text-slate-400 border-white/10 hover:border-white/20',
                activeStyle: 'bg-slate-600 text-white border-transparent',
                match: () => true 
            }
        };

        // --- 3. React 组件主体 ---
        const App = () => {
            const [keyword, setKeyword] = useState('');
            const [allItems, setAllItems] = useState([]);
            const [filteredItems, setFilteredItems] = useState([]);
            const [activeTab, setActiveTab] = useState('all');
            const [counts, setCounts] = useState({});
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [apiUrl, setApiUrl] = useState(DEFAULT_API);
            
            const [showSettings, setShowSettings] = useState(false);
            const [secretCount, setSecretCount] = useState(0);
            const [downloadModal, setDownloadModal] = useState({ show: false, url: '' });

            useEffect(() => {
                const savedUrl = localStorage.getItem('pansou_custom_api');
                if (savedUrl) setApiUrl(savedUrl);
            }, []);

            const handleSecret = () => {
                setSecretCount(p => p + 1);
                if (secretCount + 1 >= 5) {
                setShowSettings(true);
                setSecretCount(0);
                }
                setTimeout(() => setSecretCount(0), 3000);
            };

            const getSafeUrl = () => {
                let url = apiUrl.trim();
                // 强制修正为 https，避免 GitHub Pages Mixed Content 报错
                if (url.startsWith('http://')) url = url.replace('http://', 'https://');
                if (!url.startsWith('https://')) url = `https://${url}`;
                if (url.endsWith('/')) url = url.slice(0, -1);
                return url;
            };

            const handleSearch = async (e) => {
                if (e) e.preventDefault();
                if (!keyword.trim()) return;

                const dangerWord = checkSafety(keyword);
                if (dangerWord) {
                setError(`关键词包含违规内容，系统已自动拦截。`);
                setAllItems([]);
                return;
                }

                setLoading(true);
                setError(null);
                setAllItems([]);
                setFilteredItems([]);
                setCounts({});

                try {
                const targetUrl = `${getSafeUrl()}/api/search?kw=${encodeURIComponent(keyword)}&res=merge`;
                const response = await fetch(targetUrl);
                const rawText = await response.text();
                let data;
                try { data = JSON.parse(rawText); } catch (e) { throw new Error("API Error"); }

                let rawList = [];
                if (data?.data?.merged_by_type) {
                    Object.values(data.data.merged_by_type).forEach(arr => { if (Array.isArray(arr)) rawList = [...rawList, ...arr]; });
                } else if (data?.data && Array.isArray(data.data)) rawList = data.data;
                else if (data?.list && Array.isArray(data.list)) rawList = data.list;
                else if (Array.isArray(data)) rawList = data;

                const processedList = rawList.map(item => {
                    const url = item.url || "";
                    let provider = 'other';
                    for (const key in PROVIDERS) {
                    if (key !== 'other' && PROVIDERS[key].match(url)) {
                        provider = key;
                        break;
                    }
                    }
                    return {
                    name: item.note || item.name || "未知资源",
                    url, provider,
                    time: item.datetime || item.time || ""
                    };
                }).filter(item => item.url && item.url.startsWith('http'));

                if (processedList.length === 0) setError("未找到资源，请尝试缩短关键词");

                setAllItems(processedList);

                const newCounts = { all: processedList.length };
                processedList.forEach(item => {
                    newCounts[item.provider] = (newCounts[item.provider] || 0) + 1;
                });
                setCounts(newCounts);

                if (newCounts['aliyun'] > 0) {
                    setActiveTab('aliyun');
                    setFilteredItems(processedList.filter(i => i.provider === 'aliyun'));
                } else {
                    setActiveTab('all');
                    setFilteredItems(processedList);
                }

                } catch (err) {
                    setError("请求失败：可能是接口限制或网络问题 (请确保API支持HTTPS)");
                    console.error(err);
                } finally {
                    setLoading(false);
                }
            };

            const switchTab = (tabId) => {
                setActiveTab(tabId);
                setFilteredItems(tabId === 'all' ? allItems : allItems.filter(i => i.provider === tabId));
            };

            const handleItemClick = (item) => {
                if (item.provider === 'aliyun') {
                setDownloadModal({ show: true, url: item.url });
                } else {
                window.open(item.url, '_blank');
                }
            };

            return (
                <div className="min-h-screen bg-[#050301] text-slate-200 font-sans selection:bg-orange-500/30 overflow-x-hidden">
                
                {/* 极简背景氛围 */}
                <div className="fixed inset-0 pointer-events-none">
                    <div className="absolute top-[-20%] left-0 w-full h-[600px] bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-orange-800/20 via-[#0a0500] to-[#050301]"></div>
                </div>

                {/* 隐形导航 */}
                <nav className="fixed top-0 w-full z-50 px-6 py-6 pointer-events-none">
                    <button 
                    onClick={handleSecret}
                    className="pointer-events-auto p-4 opacity-0 hover:opacity-100 transition-opacity"
                    >
                    <Icons.Cloud size={24} className="text-white/10" />
                    </button>
                </nav>

                <main className="relative z-10 pt-32 pb-20 px-4 md:px-0">
                    
                    <div className="max-w-xl mx-auto text-center mb-10">
                    
                    {/* 搜索框 */}
                    <div className="relative group max-w-lg mx-auto mb-16">
                        <div className="absolute -inset-1 bg-gradient-to-r from-orange-600 via-amber-600 to-red-600 rounded-[2rem] blur-xl opacity-20 group-focus-within:opacity-50 animate-pulse transition duration-1000"></div>
                        
                        <form onSubmit={handleSearch} className="relative flex items-center bg-[#120a05]/90 backdrop-blur-xl border border-orange-500/20 rounded-[1.5rem] p-1.5 shadow-2xl transition-all focus-within:border-orange-500/50">
                        <div className="pl-5 text-orange-500/60 group-focus-within:text-orange-400 transition-colors">
                            <Icons.Search size={22} />
                        </div>
                        <input 
                            type="text" 
                            value={keyword}
                            onChange={(e) => setKeyword(e.target.value)}
                            placeholder="搜你所想..." 
                            className="w-full h-12 px-4 bg-transparent outline-none text-white text-lg placeholder:text-white/10 font-bold text-center tracking-wide"
                        />
                        <button 
                            type="submit"
                            disabled={loading}
                            className="h-12 px-6 bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-500 hover:to-amber-500 text-white rounded-2xl font-black transition-all shadow-lg shadow-orange-900/40 active:scale-95 disabled:opacity-50 flex items-center justify-center"
                        >
                            {loading ? <Icons.Loader2 className="animate-spin" size={20} /> : "GO"}
                        </button>
                        </form>
                    </div>

                    {/* 首页视觉 */}
                    {!loading && allItems.length === 0 && !error && (
                        <div className="animate-in fade-in zoom-in duration-1000 select-none cursor-default">
                        <h1 className="text-5xl md:text-6xl font-black italic tracking-tighter mb-4">
                            <span className="text-transparent bg-clip-text bg-gradient-to-br from-orange-400 via-amber-200 to-orange-500 drop-shadow-[0_0_15px_rgba(245,158,11,0.5)]">
                            阿里云盘
                            </span>
                        </h1>
                        <h2 className="text-2xl md:text-3xl font-black text-white/90 tracking-widest drop-shadow-[0_0_10px_rgba(255,255,255,0.3)]">
                            不用会员也能看
                        </h2>
                        <div className="mt-8 flex justify-center opacity-50">
                            <div className="w-16 h-1 bg-gradient-to-r from-transparent via-orange-500 to-transparent rounded-full"></div>
                        </div>
                        </div>
                    )}
                    </div>

                    {/* 错误提示 */}
                    {error && (
                    <div className="max-w-md mx-auto mb-8 p-3 bg-red-900/20 border border-red-500/20 rounded-lg text-center text-red-400 text-sm animate-in fade-in">
                        {error}
                    </div>
                    )}

                    {/* 分类标签 */}
                    {!loading && allItems.length > 0 && (
                    <div className="max-w-5xl mx-auto mb-6 flex justify-center flex-wrap gap-2 animate-in slide-in-from-bottom-2">
                        {Object.keys(PROVIDERS).map(key => {
                        const count = counts[key] || 0;
                        if (count === 0 && key !== 'other') return null;
                        const p = PROVIDERS[key];
                        const isActive = activeTab === key;
                        return (
                            <button key={key} onClick={() => switchTab(key)} className={`px-4 py-2 rounded-xl text-xs font-bold border transition-all flex items-center gap-1.5 ${isActive ? p.activeStyle : p.style + ' bg-white/5'}`}>
                            {p.icon} {p.name} <span className="opacity-60 text-[10px]">{count}</span>
                            </button>
                        )
                        })}
                        <button onClick={() => switchTab('all')} className={`px-4 py-2 rounded-xl text-xs font-bold border transition-all ${activeTab === 'all' ? 'bg-slate-700 text-white border-transparent' : 'bg-white/5 text-slate-500 border-white/5 hover:bg-white/10'}`}>
                        全部
                        </button>
                    </div>
                    )}

                    {/* 结果列表 */}
                    <div className="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-3">
                    {filteredItems.map((item, idx) => {
                        const p = PROVIDERS[item.provider];
                        const isAliyun = item.provider === 'aliyun';

                        return (
                        <div key={idx} className={`group relative backdrop-blur-md border rounded-2xl p-4 transition-all duration-300 active:scale-[0.99] ${isAliyun ? 'bg-[#120804]/90 border-orange-500/30 shadow-[0_4px_20px_-5px_rgba(249,115,22,0.15)]' : 'bg-[#18181b]/60 border-white/5'}`}>
                            {isAliyun && (
                            <div className="absolute -top-px -right-px px-2 py-0.5 bg-orange-600/20 rounded-bl-lg border-b border-l border-orange-500/20">
                                <span className="text-[9px] font-bold text-orange-400 flex items-center gap-1"><Icons.Flame size={8} fill="currentColor" />极速</span>
                            </div>
                            )}
                            <div className="flex gap-3 items-center">
                            <div className={`p-2.5 rounded-xl shrink-0 ${isAliyun ? 'bg-orange-500/10 text-orange-500' : 'bg-white/5 text-slate-500'}`}>{p.icon}</div>
                            <div className="flex-1 min-w-0">
                                <h3 className={`font-bold text-sm truncate pr-4 mb-1 ${isAliyun ? 'text-orange-50' : 'text-slate-300'}`}>{item.name}</h3>
                                <div className="flex items-center gap-2">
                                <span className={`text-[9px] px-1.5 py-0.5 rounded border ${isAliyun ? 'bg-orange-500/10 border-orange-500/20 text-orange-400' : 'bg-white/5 border-white/5 text-slate-500'}`}>{p.name}</span>
                                {item.time && <span className="text-[9px] text-slate-500 font-mono">{item.time.replace('T', ' ').substring(0, 10)}</span>}
                                </div>
                            </div>
                            </div>
                            <div className="mt-4 flex gap-2 opacity-80">
                            <button onClick={() => navigator.clipboard.writeText(item.url).then(()=>alert("已复制"))} className="flex-1 py-2 bg-white/5 rounded-lg text-[10px] font-bold text-slate-400">复制</button>
                            <button onClick={() => handleItemClick(item)} className={`flex-1 py-2 rounded-lg text-[10px] font-bold text-white shadow-lg ${isAliyun ? 'bg-gradient-to-r from-orange-600 to-amber-600' : 'bg-slate-700'}`}>打开</button>
                            </div>
                        </div>
                        )
                    })}
                    </div>
                </main>

                {/* 变现拦截弹窗 */}
                {downloadModal.show && (
                    <div className="fixed inset-0 z-[200] flex items-center justify-center bg-black/90 backdrop-blur-sm p-8 animate-in fade-in">
                    <div className="bg-[#120a05] w-full max-w-sm rounded-3xl border border-orange-500/40 p-8 relative shadow-[0_0_60px_rgba(234,88,12,0.4)] animate-in zoom-in-95">
                        <button onClick={() => setDownloadModal({show:false, url:''})} className="absolute top-4 right-4 text-slate-600 hover:text-white"><Icons.X size={20}/></button>
                        <div className="text-center">
                            <div className="inline-block p-4 rounded-full bg-orange-500/10 text-orange-500 mb-6 animate-bounce"><Icons.Gift size={32} fill="currentColor" /></div>
                            
                            <h3 className="text-xl font-black text-white mb-6">
                            不用会员也能看，不限速！
                            </h3>

                            <div className="space-y-3">
                            <a href={COMMISSION_LINK} target="_blank" rel="noopener noreferrer" onClick={() => setDownloadModal({show:false, url:''})} className="flex items-center justify-center gap-2 w-full py-4 bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-500 hover:to-amber-500 text-white font-black rounded-xl shadow-lg shadow-orange-900/40 active:scale-95 transition-all text-sm">
                                <Icons.Play size={16} fill="currentColor" /> 前往观看
                            </a>
                            <a href={downloadModal.url} target="_blank" rel="noopener noreferrer" onClick={() => setDownloadModal({show:false, url:''})} className="block w-full py-2 text-[10px] font-bold text-slate-600 hover:text-white transition-colors">
                                已安装，直接前往 &gt;
                            </a>
                            </div>
                        </div>
                    </div>
                    </div>
                )}

                {/* 隐形设置 */}
                {showSettings && (
                    <div className="fixed inset-0 z-[300] flex items-center justify-center bg-black/90 p-8">
                    <div className="bg-[#111] p-6 rounded-2xl w-full max-w-sm border border-white/10">
                        <h3 className="font-bold text-white mb-4">API Config</h3>
                        <input value={apiUrl} onChange={e => {setApiUrl(e.target.value); localStorage.setItem('pansou_custom_api', e.target.value)}} className="w-full bg-black border border-white/20 p-3 text-white rounded-lg text-xs font-mono outline-none focus:border-orange-500"/>
                        <button onClick={() => setShowSettings(false)} className="mt-4 w-full py-3 bg-white text-black font-bold rounded-lg text-xs">保存</button>
                    </div>
                    </div>
                )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>